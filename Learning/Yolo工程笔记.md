1、文件上传

modelform方法创建表单并做到批量上传难, 于是使用自定义逻辑的方法上传文件到数据库



Date: 24-4-4

1. 表设计
   - User表
   - DetectSet表
   - OriginImg表
2. 



Date: 24-4-5

1. 用户登录/注册

   - 用户注册界面

     1. 确认密码，密码使用md5加密，创建简单的函数进行了封装，函数效果为传入字符串并返回该字符串的md5加密后字符串，其中hashlib调用的是django.settings文件中自带的key

        ;

        ![image-20240405095358694](pic_yolo/image-20240405095358694.png)

     2. 密码使用PasswordInput以隐藏密码, 因为继承了自定义类BootstrapModelForm，pwd的输入时会显示密码，所以此处为pwd框切换成PasswordInput模式以隐藏密码

     ![image-20240405094858775](pic_yolo/image-20240405094858775.png)

     3. 钩子函数：

        - 用户名钩子：返回名字监测用户名是否在表中存在，若存在则返回用户已存在的错误到页面上
        - 密码钩子：调用自定义的md5函数为密码加密
        - 重复密码钩子：md5加密的同时与上面的密码进行比较，若不同则返回错误

     4. 注册页面：

        由modelform自动生成输入框，并通过自定义的父类BootStrapModelForm为其添加样式，后续的输入框基本由此方式渲染，下方增加span标签的错误信息，如果返回错误时在此处显示，同时使用position悬浮让其在返回错误信息时确保不会改变输入框页面布局

     5. ajax请求：

        注册使用ajax请求达到在不刷新页面的情况下能够返回错误信息，其中ajax以post的请求把表单信息发送到当前的url，在当前的url函数中遇到post请求将会用modelform的方法验证表单信息，正确则保存并返回True到ajax，错误则返回Flase的同时返回错误信息，ajax获取页面信息后将错误信息添加到页面中

     

   - 用户注册函数

   - 用户登录界面

     新建User的modelform表，界面输入框与错误显示设计与前面所提相同

   - 用户登录函数

     使用form表单发送post请求的方法，登录后会验证用户是否在用户表中存在，若不存在会返回错误在输入框下方，若存在则发放cookie并添加session在数据库中，其中保存在session中的数据为字典'info'，内部的值为'uid'和'name'，以传递用户的id和名字

   - 用户登录中间件

     创建中间件Check_Cookie，在发送request请求的时候添加检查cookie的函数，如果登录成功后浏览器保存有cookie对应的session则可以访问网页，如果未登录，即没有cookie或者无cookie对应的session时访问其他网页都会跳转回登录界面，只有登录和注册界面能够进入。

     在这个中间件中不需要设置response

     ![image-20240405122440472](pic_yolo/image-20240405122440472.png)

2. utils/BootstrapForm创建

3. yolo/main首页

   登录后进入首页，同时会将session中保存的用户信息传递给页面渲染，其中保存的信息用来新建个人的监测图片/视频集合，以及在页面的右上角显示为个人的信息

4. 上传图片

   - 选择图片集界面：

     上面

   - 新建图片集：

     新建图片集时只需要在下方输入集合名，用ajax传递请求的数据包括输入的集合名，集合的类型'img'以及当前的用户id，在函数中对集合名进行查询是否已存在，若不存在则创建类型为img切所属用户为当前用户的数据成功并跳转到为这个集合添加图片的界面，若存在则返回错误信息在输入框下面，并提示已存在可以在上面的选择框中选择该图片集或重新创建

5. select-option类

   封装类select-option，输入集合的类型和集合的所属人，在内部获取相关类型的所有集合，格式化把这些集合名都分别创建为一个select的option选项的html字段，输出所有这些字段到html的select标签中显示，即可做到动态获取特定人的特定类型的所有目标在选项框中显示，并且每个选项框的value值都是相应的集合在数据库中的id，方便后续操作

   如果没有找到对应的数据，则会返回'空'选项在选项框